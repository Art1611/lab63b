## การทดลองที่ 7 การรีเซตไวไฟ

### วัตถุประสงค์ 
1. เพื่อศึกษาการออกแบบการเขียนโปรแกรม
2. เพื่อศึกษาการประยุกต์ใช้ไมโครคอนโทรเลอร์(ESP-01)
3. เพื่อรีเซตไวไฟเมื่อสัญญาณไม่ค่อยดี


### อุปกรณ์ที่ใช้
1. ไมโครคอนโทรเลอร์ (ESP-01)
2. อุปกรณ์เชื่อมต่อแบบ USB
3. ซีเรียล


### ศึกษาข้อมูลเบื้องต้น
#### 02 run example 2
https://www.youtube.com/watch?v=yBjab0UNuB8

#### 06 run wiri AP
https://www.youtube.com/watch?v=T26DVHePlTs

#### ไมโครคอนโทรเลอร์
http://fitrox.lnwshop.com/article/28/esp8266-%E0%B8%95%E0%B8%AD%E0%B8%99%E0%B8%97%E0%B8%B5%E0%B9%88-1-%E0%B8%A3%E0%B8%B9%E0%B9%89%E0%B8%88%E0%B8%B1%E0%B8%81%E0%B8%81%E0%B8%B1%E0%B8%9A-esp8266

#### การปิด เปิดไฟด้วยเว็บเซอร์เวอร์ที่สร้าง (เพิ่มเติม)
https://www.youtube.com/watch?v=p6Eo9YWHecc

#### ESP8266WiFi.h
https://github.com/esp8266/Arduino/blob/master/libraries/ESP8266WiFi/src/ESP8266WiFi.h

#### RSSI
http://telecom10.blogspot.com/2015/05/rssi.html#:~:text=RSSI%20%3A%20Received%20Signal%20Strength%20Indication,%E0%B8%A2%E0%B8%B4%E0%B9%88%E0%B8%87%E0%B8%95%E0%B8%B4%E0%B8%94%E0%B8%A5%E0%B8%9A%E0%B8%99%E0%B9%89%E0%B8%AD%E0%B8%A2%E0%B8%A2%E0%B8%B4%E0%B9%88%E0%B8%87%E0%B8%94%E0%B8%B5&text=%2D%20%E0%B8%AA%E0%B8%B1%E0%B8%8D%E0%B8%8D%E0%B8%B2%E0%B8%93%E0%B8%A1%E0%B8%B5%E0%B8%84%E0%B8%A7%E0%B8%B2%E0%B8%A1%E0%B9%81%E0%B8%A3%E0%B8%87%E0%B8%A3%E0%B8%B0%E0%B8%94%E0%B8%B1%E0%B8%9A%20%2D60%20%E0%B8%96%E0%B8%B6%E0%B8%87%20%2D75%20dBm,%E0%B8%AA%E0%B8%B1%E0%B8%8D%E0%B8%8D%E0%B8%B2%E0%B8%93%E0%B9%81%E0%B8%A3%E0%B8%87%20%E0%B9%80%E0%B8%95%E0%B9%87%E0%B8%A1%E0%B8%97%E0%B8%B8%E0%B8%81%E0%B8%82%E0%B8%B5%E0%B8%94


### วิธีการทดลอง
1. เขียนโปรแกรมลงใน **visual studio code** โดยใช้ภาษา C
```C
#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>

const char* ssid = "ESP8266_Wifi";
const char* password = "sittichai";

IPAddress local_ip(192, 168, 1, 1);
IPAddress gateway(192, 168, 1, 1);
IPAddress subnet(255, 255, 255, 0);

ESP8266WebServer server(80);

int cnt = 0;

void setup(void){
	Serial.begin(115200);

	WiFi.softAP(ssid, password);
	WiFi.softAPConfig(local_ip, geteway, subnet);
	delay(100);

	server.onNotFound([]() {
		server.send(404, "text/plain", "Path Not Found");
	});

	server.on("/", []() {
		cnt++;
		String msg = "Hello cnt: ";
		msg += cnt;
		server.send(200, "text/plain",msg);
	});

	server.begin();
	Serial.println("HTTP server started");
}

void loop(void){
	server.handleClient();
// สัญญาณน็ตแรง ควรมีค่า -75 <= RSSI 
	int a = 0
	whlie(a==0) ;
		float RSSI = WiFi.RSSI()
  		if(-75 <= RSSI) {
			Serial.println("สัญญาณเน็ตปกติดี");
		} else {
			Serial.println("รีเซตไวไฟ");
			Serial.println("กรุณากดปุ่มสีดำเพื่อรีเซต");
			break;
			}
		delay(1000)
}

```
2. ต่ออุปกรณ์ USB เข้ากับซีเรียล
3. ต่อซีเรียลเข้ากับไมโครคอนโทรเลอร์
4. เปิด Command Prompt แล้วเข้าไปในโฟล์เดอร์ที่จะอัพโหลด เช่น ไดฟ์ D ไฟล์ ชื่อ test wifi_reset
  พิมพ์ **d:** แล้วกด **Enter**
  พิมพ์ **cd test wifi reset** แล้วกด **Enter**
 โดยการทดลองที่ 7 จะเป็นทดสอบการตรวจสอบความแรงของไวไฟกรณีที่สัญญาณไม่ดีบนจอคอมจะสั่งให้รีเซตไวไฟโดยกดปุ่มสีดำที่ไมโครคอนโทรเลอร์ 
 สามารถเช็คโปรแกรมที่ใช้รันได้โดย พิมพ์ **vi src/main.cpp** แล้วกด **Enter**โดยจะแสดงโค้ดที่เขียนจากข้อที่ 1
5. อัพโหลดโปรแกรม โดยพิมพ์ **pio run -t upload** แล้วกด **Enter** ในขณะที่รันโปรแกรมเพื่อให้ไมโครคอนโทรเลอร์รับโปกรแกรมใหม่เข้าไป ให้กดปุ่มดำค้าง แล้วกดปุ่มแดง 1 ครั้ง เพื่อเป็นการรีเซต
6. เมื่อลงโปรแกรมเสร็จแล้ว พิมพ์ **pio device monitor** แล้วกด **Enter** เพื่อดูผลลัพท์โดยการแสดงผลจากคอมพิวเตอร์ สามารถกดปุ่มสีแดงเพื่อรีเซต
7. สังเกต บันทึกผล และอธิปรายผล

### การบันทึกผลการทดลอง
   จากการทดลอง พบว่า เหมือนสัญญาณเน็ตดี หรือ มีค่า RSSI มากกว่าหรือเท่ากับ -75 จะสามารถใช้งานไวไฟได้ตามปกติ กรณีที่ สัญญาณไม่ดี หรือ RSSI น้อยกว่า -75
 จะแสดงผลบนจอคอม ว่าให้ทำการรีเซต โดนกดปุ่มดำ


### อภิปรายผลการทดลอง
   จากการได้รันโปรแกรมเข้าไปในไมโครคอนโทรเลอร์แล้วจะทำให้ไมโครคอนโทรเลอร์สร้างไวไฟมาได้และสามารถใช้งานได้ และเพื่อที่จะดูว่าสัญญาณดีแค่ไหนจึงเช็คค่า RSSI ถ้าสัญญาณดี
 จะแสดงว่า " สัญญาณปกติดี " แต่ถ้าสัญญาณไม่ได้จะแสดงคำว่า "รีเซตไวไฟ กรุณากดปุ่มสีดำเพื่อรีเซต" ให้กดปุ่มสีดำเพื่อรีเซต 


### คำถามหลังการทดลอง
1. ถ้าอยากให้ทำการรีเซตเองต้องทำไง
   - ไม่ค่อยแน่ใจว่าทำอย่างไร แต่คิดว่า ต้องเขียนโค้ค กรณีเน็ตสัญญาณไม่ดี หรือ RSSI น้อยกว่า -75 คือให้ทำการรันโปรแกรมใหม่ไรประมาณนี้

2. การนำไปประยุกต์ใช้ในูปแบบอื่น ๆ
   - การเปิด-ปิดไฟโดนสั่งจากเว็บเซอร์เวอร์ที่สร้างเอง
   
3. วัตถุประสงค์หลัก ๆ ของแลปทั้ง 7 คือ อะไร
   - เพื่อให้รู้จัก วิธีใช้ ประโยชน์ของไมโครคอนโทรเลอร์ว่าทำอะไรได้บ้าง สามารถนำมาประยุกต์ใช้ไรได้บ้าง
   - ให้จักอุปกรณ์ต่าง ๆ คุณสมบัติของอุปกรณ์ อุปกรณ์ เช่น รีเลย์ เซนเซอร์แสง และอื่น ๆ
   - เรียนรู้วิธีการเขียนโปรแกรมภาษา C และอ่าน code 
   - ให้รู้จัก PlatformIO จากเว็บ https://platformio.org/
   - ให้รู้จัก github และ การเขียนโดยใช้ markdown
   - อื่น ๆ


## จบการทดลองที่ 7 เพียงเท่านั้น
### หากมีข้อผิดพลาดประการใดข้ออภัยมา ณ ที่นี้ด้วย
## :+1: :+1:  :+1:  :+1:  :+1: 
## ขอบคุณสำหรับการสอน Lab ทั้ง 4 ครั้ง ขอบคุณครับ
